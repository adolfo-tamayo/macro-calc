<html>
    <head>
        <meta charset="UTF-8">
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
        <link href="https://fonts.googleapis.com/css?family=Roboto&display=swap" rel="stylesheet">
        <meta name="viewport" content="width=device-width, initial-scale=1">
    </head>
    <body style="font-family: 'Roboto', sans-serif;">
        <div class="container">
            <div class="row">
                <div class="col-sm" id='myContainer' style="padding: 1em;">
                    <form id="calcform">
                        <div class="form-group">
                            <label for="gender">Sexo:</label>
                            <select class="form-control" id="gender">
                                <option value="m">Masculino</option>
                                <option value="f">Femenino</option>
                            </select>
                        </div>
                        <div class="row">
                            <div class="col">
                                <div class="form-group">
                                    <label for="age">Edad:</label>
                                    <input type="number" class="form-control" min="1" max="99" id="age" placeholder="Edad" required>
                                    <!-- <small id="ageHelp" class="form-text text-muted">Tu edad nos ayuda a determinar tu consumo cal칩rico</small> -->
                                </div>
                            </div>
                            <div class="col">
                                <div class="form-group">
                                    <label for="weight">Peso(kg):</label>
                                    <input type="number" class="form-control" min="1" id="weight" placeholder="Peso (kg)" required>
                                    <!-- <small id="ageHelp" class="form-text text-muted">Tu edad nos ayuda a determinar tu consumo cal칩rico</small> -->
                                </div>
                            </div>
                            <div class="col"> 
                                <div class="form-group">
                                    <label for="height">Altura(cm):</label>
                                    <input type="number" class="form-control" min="1" id="height" placeholder="Altura (cm)" required>
                                    <!-- <small id="ageHelp" class="form-text text-muted">Tu edad nos ayuda a determinar tu consumo cal칩rico</small> -->
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="activitySelect">Nivel de actividad:</label>
                            <select class="form-control" id="activitySelect">
                                <option value="1.375">Ligeramente Activo (Ejercicio moderado y trabajo sedentario)</option>
                                <option value="1.55">Moderadamente Activo (Ejercicio continuo pero trabajo sedentario)</option>
                                <option value="1.725">Muy Activo (Ejercicio continuo y trabajo activo)</option>
                                <option value="1.9">Extra Activo (Ejercicio intenso y trabajo activo)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="objective">Objetivo:</label>
                            <select class="form-control" id="objective">
                                <option value="loose">Quemar grasa</option>
                                <option value="keep">Mantener resultados</option>
                                <option value="gain">Aumentar musculo</option>
                            </select>
                        </div>
                        <button type="submit" class="btn btn-primary btn-block">Ver mis resultados</button>
                    </form>
                    <div id="results"></div>
                </div>
            </div>
        </div>
        <script>
            var form = document.getElementById("calcform");
            function renderResults(isResize){
                var age = document.getElementById("age").value;
                var height = document.getElementById("height").value;
                var weight = document.getElementById("weight").value;
                var activity = document.getElementById("activitySelect").value;
                var objective = document.getElementById("objective").value;
                var gender = document.getElementById("gender").value;
                var men = {
                    loose: -800,
                    keep: -400,
                    gain: 150,
                }
                var women = {
                    loose: -550,
                    keep: -300,
                    gain: 200,
                }
                var fat_ratios = {
                    loose: 0.3,
                    keep: 0.3,
                    gain: 0.2
                }
                var carb_ratios = {
                    loose: 0.3,
                    keep: 0.35,
                    gain: 0.4
                }
                var protein_ratios = {
                    loose: 0.4,
                    keep: 0.35,
                    gain: 0.4
                }

                age = Number(age)
                height = Number(height)
                weight = Number(weight)
                activity = Number(activity)
                
                var gender_cals = gender == "m" ? 5 : -161;
                var objective_cals = gender == "m" ? men[objective]: women[objective];

                var calories = 10 * weight + 6.25 * height - 5 * age + gender_cals
                console.log(calories)
                var tdee = calories * activity
                console.log(tdee)
                var intake = tdee + objective_cals
                console.log(intake)
                var protein = (protein_ratios[objective] * intake) / 4;
                var carbs = (carb_ratios[objective] * intake) / 4;
                var fats = (fat_ratios[objective] * intake) / 9;

                calories = Math.round(calories)
                tdee = Math.round(tdee)
                intake = Math.round(intake)
                protein = Math.round(protein)
                carbs = Math.round(carbs)
                fats = Math.round(fats)

                console.log(calories, tdee, intake, protein, carbs, fats)
                var resultsDiv = document.getElementById("results")
                resultsDiv.innerHTML = ""
                resultsDiv.appendChild(document.createElement("hr"))

                var dashboard = document.createElement("div")
                // var chart = document.createElement(
                //     'canvas',
                //     { 
                //         width: 200,
                //         height: 200
                //     }
                // )
                // var ctx = chart.getContext('2d');
                // var myChart = new Chart(ctx, {
                //     type: 'pie',
                //     data: {
                //         labels: ['Proteina', 'Carbohidratos', 'Grasas'],
                //         datasets: [{
                //             label: 'Macronutrientes',
                //             data: [protein, carbs, fats],
                //             backgroundColor: [
                //                 '#0fd43d',
                //                 '#1b53e0',
                //                 '#db0b3c',
                //             ],
                //             borderWidth: 1
                //         }]
                //     },
                //     options: {
                //         tooltips: {
                //             enabled: false
                //         },
                //         plugins: {
                //             datalabels: {
                //                 formatter: (value, ctx) => {
                //                     let sum = 0;
                //                     let dataArr = ctx.chart.data.datasets[0].data;
                //                     dataArr.map(data => {
                //                         sum += data;
                //                     });
                //                     let percentage = (value*100 / sum).toFixed(2)+"%";
                //                     return value + " grs";
                //                 },
                //                 color: '#fff',
                //             }
                //         }
                //     }
                //     });
                dashboard.innerHTML = `
                    <h5>Total de calorias: <b>${intake}</b></h5>
                    <br>
                    <h5>Macronutrientes:</h5>
                    <ul style="list-style: none;">
                        <li>游볼 <b>Proteina: </b> ${protein} gramos </li>
                        <li>游꼨 <b>Carbohidratos:</b> ${carbs} gramos</li>
                        <li>游볨 <b>Grasas:</b> ${fats} gramos</li>
                    </ul>
                `
                // dashboard.appendChild(chart)
                resultsDiv.appendChild(dashboard)
            }
            form.onsubmit = function (event){
                event.preventDefault()
                renderResults(false)
            }
        </script>
        <script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>
    </body>
</html>